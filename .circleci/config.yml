version: 2
jobs:
  build:
    docker:
      - image: curvetomorrow/auslan-dev-image:v7.8
        auth:
          username: $DOCKER_USER
          password: $DOCKER_PASS
    working_directory: /var/www/booking-system-frontend
    parallelism: 1
    steps:
      - checkout
      - setup_remote_docker
      - add_ssh_keys:
          fingerprints:
            - "11:70:25:a0:52:fd:40:c4:db:c9:4a:b6:e7:f2:36:f1"
      - run:
          type: shell
          name: Setup parallelism
          command: |
            circleci tests glob "/var/www/booking-system-frontend/e2e-tests/features/validation_profile_registration.feature" | circleci tests split > /var/www/booking-system-frontend/test_features_for_split_container.txt
            cat /var/www/booking-system-frontend/test_features_for_split_container.txt
      - run:
          name: Running the server and end to end test
          working_directory: /usr/src/app/booking-system-frontend
          environment:
            E2E_ENV: "localhost"
          shell: /bin/bash
          command: |
            /var/www/booking-system-frontend/setup_ci.sh
      - store_artifacts:
          path: /var/www/booking-system-frontend/.tmp/json-output