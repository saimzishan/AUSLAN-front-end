machine:
  node:
    version: 7.0.0

test:
  pre:
    - bundle exec pact-mock-service restart -p 1234 -l tmp/pact.log --pact-dir tmp/pacts
    - npm install codeclimate-test-reporter -g
  override:
    - npm run lint
    - ng test --code-coverage --watch=false
  post:
    - bundle exec pact-mock-service stop -p 1234
    - mkdir $CIRCLE_ARTIFACTS/coverage
    - mv coverage/* $CIRCLE_ARTIFACTS/coverage
    - codeclimate-test-reporter < $CIRCLE_ARTIFACTS/coverage/coverage.lcov
    - curl -v -XPUT \-H "Content-Type: application/json" -d@pacts/user-specs-user-api.json https://auslan-pact-broker.herokuapp.com/pacts/provider/User-Api/consumer/User-Specs/version/latest --user admin:auslanPACT


deployment:
  stagging:
    branch: dev-master
    commands:
      - ng build --target=development
      - aws s3 sync dist/  s3://auslan-booking-system-ct/ --delete

  prod:
    branch: master
    commands:
      - ng build --target=production
      - aws s3 sync dist/  s3://auslan-booking-system-ct/ --delete
