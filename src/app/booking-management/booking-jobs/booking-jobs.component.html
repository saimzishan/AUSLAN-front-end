<header id="header-mobile">
    <button [routerLink]="['/booking-management']" class="icon-back"></button>
    <h1 *ngIf="!jobAccessError">JOB #{{selectedBookingModel.id | PrettyID}}</h1>
</header>

<ng-container *ngIf="!jobAccessError">
    <section id="page-common">
        <app-booking-header [bookingState]="selectedBookingModel.state"
                            [hasLinkId]="!!selectedBookingModel.link_id"
                            [isCancelOrUnable]="isCancelledOrUnableToServe"
                            [invitePress]="invitePressed"
                            [unAssignPress]="unAssignPressed"
                            [reAssignPress]="reAssignPressed"
                            [unlinkPress]="unlinkPressed"
                            [showButtons]="true"
                            [disableReject]="disableReject"
                            [disableAccept]="disableAccept">
        </app-booking-header>

        <div class="job-status">
            <span [ngClass]="{'status-accepted': stateStr === 'IN PROGRESS - Accepted',
                             'status-invited': stateStr === 'IN PROGRESS - Invited',
                             'status-declined': stateStr === 'IN PROGRESS - Rejected',
                             'status-tentative': stateStr === 'IN PROGRESS - Tentative',
                             'status-allocated': stateStr === 'ALLOCATED'}">
                {{stateStr}}
                <i class="icon-requested"></i>
            </span>
        </div>

        <section id="job-booking">
            <main>
                <h2>Job Details</h2>
                <table id="job-details-responsive" class="custom-small-table">
                    <thead>
                    <tr>
                        <th width="5%">Job</th>
                        <th width="7%">Time</th>
                        <th width="7%">Date</th>
                        <th width="7%">Org</th>
                        <th width="6%">Client</th>
                        <th width="6%">Venue</th>
                        <th width="6%">Address</th>
                        <th width="7%">Suburb</th>
                        <th width="5%">Type</th>
                        <th width="7%">People</th>
                        <th width="12%">Special Instructions</th>
                        <th width="4%">Attached</th>
                        <th width="7%">Date Added</th>
                        <th width="8%">Updated</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td data-title="JOB NUMBER">
                            {{selectedBookingModel.id | PrettyID}}
                            <span data-title="Link ID" *ngIf="isCurrentUserAdminOrBookingOfficer() && !!selectedBookingModel.link_id" class="linkId">
                                <a>#{{selectedBookingModel.link_id}}</a>
                            </span>
                        </td>
                        <td data-title="TIME">
                            <span>{{selectedBookingModel.venue.start_time_iso | date:'shortTime'}} - {{selectedBookingModel.venue.end_time_iso | date:'shortTime'}}</span>
                        </td>
                        <td data-title="DATE"><span>{{selectedBookingModel.venue.start_time_iso | date:'EEE d MMM yy'}}</span></td>
                        <td data-title="ORGANISATION">{{selectedBookingModel.client.organisation_name}}</td>
                        <td data-title="CLIENT">
                            {{selectedBookingModel.deaf_person.first_name +
                            ' ' +
                            selectedBookingModel.deaf_person.last_name}}
                        </td>
                        <td data-title="VENUE">{{selectedBookingModel.venue.title}}</td>
                        <td data-title="ADDRESS">
                            <a target="_blank"
                               href="{{'https://www.google.com.au/maps/place/' + selectedBookingModel.venue.street_number + ' ' + selectedBookingModel.venue.street_name + ' ' + selectedBookingModel.venue.suburb}}">
                                {{selectedBookingModel.venue.street_number
                                + ' ' + selectedBookingModel.venue.street_name }}
                            </a>
                        </td>
                        <td data-title="SUBURB">
                            <a target="_blank"
                               href="{{'https://www.google.com.au/maps/place/' +selectedBookingModel.venue.suburb}}">
                                {{selectedBookingModel.venue.suburb}}
                            </a>
                        </td>
                        <td data-title="TYPE OF JOB">{{selectedBookingModel.nature_of_appointment}}</td>
                        <td data-title="PEOPLE">{{selectedBookingModel.venue.expected_attendance}}</td>
                        <td data-title="SPECIAL INSTRUCTIONS" class="new-line">
                            {{selectedBookingModel.special_instructions}}
                        </td>
                        <td align="center" data-title="Attached">
                            <ul *ngIf="selectedBookingModel.documents_attributes.length > 0"
                                class="dropdown menu custom"
                                data-dropdown-menu>
                                <li>
                                    <a href="#" class="icon-attach"></a>
                                    <ul class="menu">
                                        <li *ngFor="let attachment of selectedBookingModel.documents_attributes">
                                            <a  download
                                                href="{{attachment.url}}">
                                                <i class="icon-attach"></i> {{attachment.file_name}}
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </td>
                        <td data-title="Date Added">61 days (27 Jan)</td>
                        <td data-title="UPDATED"><span class="underline">02-06 TS<br>7:15 A</span></td>
                    </tr>
                    </tbody>
                </table>
                <ng-container *ngIf="anyInterpreterAccepted() && !isCurrentUserInterpreter()">
                    <div class="manage-interpreters-wrapper">
                        <section name="manage-interpreters-a" class="manage-interpreters">
                            <section>
                                <ng-container
                                        *ngFor="let interpreter of selectedBookingModel.interpreters; let i=index">
                                    <div *ngIf="i < selectedBookingModel.interpreters_required">
                                        <b>Interpreter {{i + 1}} :</b>
                                        <span *ngIf="interpreter.state === 'Accepted'" class='interpreter-accepted'>{{interpreter.first_name}} {{interpreter.last_name}}</span>
                                        <span *ngIf="interpreter.state !== 'Accepted'">To be filled</span>
                                        <button name="{{'unassingBtn_' + +(i + 1)}}"
                                                (click)="unAssignInterpreters(interpreter.id)"
                                                *ngIf="!isCurrentUserInterpreter() && (false === isActiveState('Unable_to_service') && false === isActiveState('Cancelled_no_charge')) && interpreter.state === 'Accepted'">
                                            Unassign
                                        </button>
                                    </div>
                                </ng-container>
                                <ng-container *ngIf="(selectedBookingModel.interpreters_required - selectedBookingModel.interpreters.length) > 0">
                                    <ng-container *ngFor="let numb of counter(selectedBookingModel.interpreters_required - selectedBookingModel.interpreters.length ); let ii=index">
                                        <ng-container *ngIf="ii < (selectedBookingModel.interpreters_required - selectedBookingModel.interpreters.length)">
                                            <div>
                                                <strong>
                                                    Interpreter {{selectedBookingModel.interpreters.length + ii + 1}} :
                                                </strong>
                                                <span>To be filled</span>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </section>
                        </section>
                    </div>
                </ng-container>
                <ng-container *ngIf="!anyInterpreterAccepted() && !isCurrentUserInterpreter()">
                    <div class="manage-interpreters-wrapper">
                        <section name="manage-interpreters-b"  class="manage-interpreters">
                            <section>
                                <div *ngFor="let numb of counter(selectedBookingModel.interpreters_required); let i=index">
                                    <b>Interpreter {{i + 1}} :</b>
                                    <span>To be filled</span>
                                </div>
                            </section>
                        </section>
                    </div>
                </ng-container>
                <section class="columns small-padding">
                    <ng-container *ngIf="anyInterpreterAccepted()">
                        <ng-container *ngFor="let interpreter of selectedBookingModel.interpreters; let i=index">
                            <ng-container *ngIf="i < selectedBookingModel.interpreters_required">
                                <div *ngIf="interpreter.state === 'Accepted'"
                                     class="row with-border">
                                    <div>
                                        INTERPRETER {{i + 1}}
                                    </div>
                                    <span class="with-avatar">
                                        <img class="img-circle" src="{{interpreter.photo_url}}" alt="">
                                        {{interpreter.first_name}} {{interpreter.last_name}}
                                    </span>
                                </div>
                                <div *ngIf="interpreter.state !== 'Accepted'"
                                     class="row with-border">
                                    <div> INTERPRETER {{i + 1}}</div>
                                    <span>To be filled</span>
                                </div>
                            </ng-container>
                        </ng-container>
                        <ng-container
                                *ngIf="(selectedBookingModel.interpreters_required - selectedBookingModel.interpreters.length) > 0">
                            <ng-container
                                    *ngFor="let numb of counter(selectedBookingModel.interpreters_required - selectedBookingModel.interpreters.length ); let ii=index">
                                <ng-container
                                        *ngIf="ii < (selectedBookingModel.interpreters_required - selectedBookingModel.interpreters.length)">
                                    <div class="row with-border">
                                        <div> INTERPRETER {{selectedBookingModel.interpreters.length + ii + 1}}</div>
                                        <span>To be filled</span>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngIf="!anyInterpreterAccepted()">
                        <ng-container
                                *ngFor="let numb of counter(selectedBookingModel.interpreters_required); let i=index">
                            <ng-container *ngIf="i < selectedBookingModel.interpreters_required">
                                <div class="row with-border">
                                    <div> INTERPRETER {{i + 1}}</div>
                                    <span>To be filled</span>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>

                    <div *ngIf="(selectedBookingModel.notes) && selectedBookingModel.notes.length > 0 && isCurrentUserInterpreter()"
                         class="row">
                        <span>DESCRIPTION</span>
                    </div>
                    <p *ngIf="isCurrentUserInterpreter()">{{selectedBookingModel.notes}}</p>
                    <div class="row"
                         *ngIf="selectedBookingModel.documents_attributes.length > 0 && isCurrentUserInterpreter()">
                        <span>ATTACHMENTS</span>
                    </div>
                    <div *ngIf="selectedBookingModel.documents_attributes.length > 0 && isCurrentUserInterpreter()">
                        <ul class="attachments" *ngIf="selectedBookingModel.documents_attributes.length > 0">
                            <li *ngFor="let attachment of selectedBookingModel.documents_attributes">
                                <a download href="{{attachment.url}}">
                                    <i class="icon-attach"></i>
                                </a>
                                <span>{{attachment.file_name}}</span>
                            </li>
                        </ul>
                    </div>
                    <ng-container *ngIf="showActions()" >
                    <div class="row" *ngIf="isCurrentUserInterpreter()">
                        <span>DO YOU WANT TO DO THIS JOB?</span>
                    </div>
                    <div class="manage-job-buttons" *ngIf="isCurrentUserInterpreter()">
                        <button class="button button-accept"
                                [ngClass]="isCurrentUserState('Accepted') ? 'button pushed button-accept' : 'button button-accept'"
                                (click)="!disableAccept && showDialogBoxInterpreter(false)">
                            <i class="icon-check-mobile"></i>
                        </button>

                        <button [disabled]="disableAccept" class="button button-help"><i class="icon-help"></i></button>

                        <button class="button button-decline"
                                [ngClass]="isCurrentUserState('Rejected') ? 'button pushed button-decline' : 'button button-decline'"
                                (click)="!disableReject && showDialogBoxInterpreter(true)">
                            <i class="icon-decline"></i>
                        </button>
                    </div>
                    </ng-container>
                </section>

                <h2 *ngIf='!isCancelledOrUnableToServe && !isCurrentUserInterpreter()'>
                    Invite Interpreters
                    <button class="outside"></button>
                </h2>
                <section *ngIf='!isCancelledOrUnableToServe && !isCurrentUserInterpreter()' id="invite-interpreters">
                    <section id="filters">
                        <section class="search-bar" style="width:150%">
                            <!--<input type="text" name="search" placeholder="Search...">-->
                            <!--<button><i class="icon-glass"></i></button>-->
                        </section>
                        <section class="filters">
                            <!--<button class="button">Select Top 10</button>-->
                            <!--<button class="button">Select All Available</button>-->
                            <!--<button class="button">Filter Only Available</button>-->

                            <div class="separator"></div>

                            <button class="button active" name='inviteBtn' (click)="inviteInterpreters()">
                                <i class="icon-shape"></i> Invite
                            </button>
                            <button class="button red" (click)="reAssignInterpreters()" name="reassingBtn">
                                <i class="icon-assign"></i> Assign
                            </button>
                        </section>
                    </section>
                </section>

                <section *ngIf='!isCancelledOrUnableToServe && !isCurrentUserInterpreter()' id="invited-interpreters">
                    <table class="custom custom-small-table">
                        <thead>
                        <tr>
                            <th width="10%">
                                <!--md-checkbox></md-checkbox -->
                            </th>
                            <th width="7%">
                                <span class="">#</span>
                            </th>
                            <th width="12%">
                                <span class="">Status</span>
                                <!--<ul class="dropdown menu custom" data-dropdown-menu>-->
                                <!--<li>-->
                                <!--<a href="#">All</a>-->
                                <!--<ul class="menu smaller">-->
                                <!--<li><a href="#"><i></i> Option 1</a></li>-->
                                <!--<li><a href="#"><i></i> Option 2</a></li>-->
                                <!--<li><a href="#"><i></i> Option 3</a></li>-->
                                <!--</ul>-->
                                <!--</li>-->
                                <!--</ul>-->
                            </th>
                            <th width="17%">
                                <span class="">First Name</span>
                                <!--<input type="text" name="">-->
                            </th>
                            <th width="17%">
                                <span class="">Last Name</span>
                                <!--<input type="text" name="">-->
                            </th>
                            <th width="9%">
                                <span class="">Role</span>
                                <!--<ul class="dropdown menu custom" data-dropdown-menu>-->
                                <!--<li>-->
                                <!--<a href="#">All</a>-->
                                <!--<ul class="menu smaller">-->
                                <!--<li><a href="#"><i></i> Option 1</a></li>-->
                                <!--<li><a href="#"><i></i> Option 2</a></li>-->
                                <!--<li><a href="#"><i></i> Option 3</a></li>-->
                                <!--</ul>-->
                                <!--</li>-->
                                <!--</ul>-->
                            </th>
                            <th width="9%">
                                <span class="">Lvl</span>
                                <!--<ul class="dropdown menu custom" data-dropdown-menu>-->
                                <!--<li>-->
                                <!--<a href="#">All</a>-->
                                <!--<ul class="menu smaller">-->
                                <!--<li><a href="#"><i></i> Option 1</a></li>-->
                                <!--<li><a href="#"><i></i> Option 2</a></li>-->
                                <!--<li><a href="#"><i></i> Option 3</a></li>-->
                                <!--</ul>-->
                                <!--</li>-->
                                <!--</ul>-->
                            </th>
                            <th width="15%">
                                <span class="">Suburb</span>
                                <!--<input type="text" name="">-->
                            </th>
                            <th width="9%">
                                <span class="">Distance</span>
                            </th>
                            <th width="9%">
                                <span class="">Travel Pay</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let user of interpreterList; let ind = index">
                            <td width="10%">
                                <md-checkbox name='{{"Check" + ind}}'
                                             [checked]="checkList[ind]===true"
                                             (change)="onChange($event,user, ind)">
                                </md-checkbox>
                            </td>
                            <td>{{user.id}}</td>
                            <td align="center">
                                <!-- i [ngClass]="{'icon-check-green' : isInvited(user.id), 'icon-check-yellow' : !isInvited(user.id)}"><i -->
                            </td>
                            <td><!-- i [ngClass]="{'icon-check-yellow' : isNotConfirmed(user.id)}"></i -->
                                {{user.first_name}}
                            </td>
                            <td>{{user.last_name}}</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>{{user.distance}}</td>
                            <td>{{ travelPayStatus(user)}}</td>
                        </tr>
                        </tbody>
                    </table>
                    <section>
                        <section id="time">11 September 9:15 AM - 11:15 AM</section>
                        <section>
                            <section id="time-range">
                                <button type="button">&lt;</button>
                                <section>
                                    <span>6 am</span>
                                    <span>7 am</span>
                                    <span>8 am</span>
                                    <span>9 am</span>
                                    <span>11 am</span>
                                    <span>12 am</span>
                                    <span>1 pm</span>
                                </section>
                                <button type="button">&gt;</button>
                            </section>
                            <section class="flow">
                                <div><span></span></div>
                                <div><span style="margin-left: 2%"></span></div>
                                <div><span style="margin-left: 15%"></span></div>
                                <div><span style="margin-left: 3%"></span></div>
                                <div><span style="margin-left: 22%"></span></div>
                            </section>
                            <div id="mover"></div>
                        </section>
                    </section>
                </section>
                <ng-container *ngIf='!isCurrentUserInterpreter()'>
                    <h2 class="hidden-mobile">History</h2>
                    <table id="changes-history" class="custom-small-table">
                        <thead>
                        <th width="20%">Date and Time</th>
                        <th width="30%">Action</th>
                        <th>Changes</th>
                        </thead>
                        <tbody>
                        <tr *ngFor="let version of selectedBookingModel.versions; let i=index">
                            <td name="data_created_at">
                                {{version.created_at_iso | date:'shortTime'}} on
                                {{version.created_at_iso | date:'EEE d MMM yy'}}
                            </td>
                            <td>
                                <img height="40px" width="40px" src="{{version.photo_url}}" alt="">
                                <span name="data_action">
                                    {{version.booking_event_formatted()}}
                                    <br/>
                                    {{version.full_name()}}
                                </span>
                            </td>
                            <td>
                                <div name="data_changes">
                                    <div>
                                        <span style="font-style: oblique; font-weight: bolder">{{version.model}}</span>
                                    </div>
                                    <div *ngFor="let change_item_key of version.change_set_formatted_hash()">
                                        <b>{{change_item_key[0]}}: </b>{{change_item_key[1][0]}} <b>to</b> <span>{{change_item_key[1][1]}}</span>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </ng-container>
            </main>
        </section>
    </section>
</ng-container>
<!-- Make this as a class-->
<ng-container *ngIf="jobAccessError">
    <div class="error" style="text-align: center;padding-top: 100px;">
        <span>
            <img src="../../../../assets/img/error-redcross.svg"/>
            <p>
                Sorry, you don't have access to this job.
            </p>
            <p>
                Contact Auslan if you think this is not right.
            </p>
        </span>
    </div>
</ng-container>
