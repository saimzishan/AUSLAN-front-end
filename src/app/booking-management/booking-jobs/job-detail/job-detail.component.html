<header id="header-mobile">
    <button [routerLink]="['/booking-management']" class="icon-back"></button>
    <h1>JOB #{{selectedBookingModel.id | PrettyID}}</h1>
</header>


<section id="page-common">
    <section id="static-flow">
        <section id="submenu">
            <nav>
                <a href="javascript:void(0);" class="active">Booking info</a>
            </nav>
            <div *ngIf="isCurrentUserInterpreter()">
                <button *ngIf="!disableReject" (click)="showDialogBox(true)"
                        class="button pink">Decline
                </button>
                <div class="sep"></div>
                <button *ngIf="!disableAccept" (click)="showDialogBox(false)"
                        class="button inverse">Accept
                </button>
            </div>
        </section>
        <section id="steps">
            <nav>
                <a href="javascript:void(0);" [ngClass]="{'active' : isActiveState('Requested'),
                'passed' : isPassedState('Requested')}">Requested</a>
                <a href="javascript:void(0);" [ngClass]="{'active' : isActiveState('In_progress'),
                'passed' : isPassedState('In_progress')}">In Progress</a>
                <a href="javascript:void(0);" [ngClass]="{'active' : isActiveState('Allocated'),
                'passed' : isPassedState('Allocated')}">Allocated</a>
                <a href="javascript:void(0);" [ngClass]="{'active' : isActiveState('Completed'),
                'passed' : isPassedState('Completed')}">Completed</a>
                <a href="javascript:void(0);"
                   [ngClass]="{'active' :  isActiveState('Unable_to_service') || isActiveState('Cancelled')}">
                    {{isActiveState('Cancelled') ? 'Cancelled' :
                    isActiveState('Unable_to_service') ? 'Unable To Serve' : 'Finished' }}
                </a>
            </nav>
        </section>
    </section>
    <div class="job-status">
    <span [ngClass]="{
    'status-accepted': stateStr === 'IN_PROGRESS - Accepted',
   'status-invited': stateStr === 'IN_PROGRESS - Invited',
   'status-declined': stateStr === 'IN_PROGRESS - Rejected',
   'status-tentative': stateStr === 'IN_PROGRESS - Tentative',
   'status-allocated': stateStr === 'ALLOCATED'}">
                {{stateStr}} <i class="icon-requested"></i>
            </span>
    </div>


    <section id="job-booking">
        <main>
            <h2>Job Details</h2>
            <table id="job-details-responsive" class="custom-small-table">
                <thead>
                <tr>
                    <th width="5%">Job</th>
                    <th width="7%">Time</th>
                    <th width="7%">Date</th>
                    <th width="7%">Org</th>
                    <th width="6%">Client</th>
                    <th width="11%">Venue</th>
                    <th width="7%">Suburb</th>
                    <th width="5%">Type</th>
                    <th width="7%">#People</th>
                    <th width="12%">Special Instructions</th>
                    <th width="4%">Attached</th>
                    <th width="7%">Date Added</th>
                    <th width="8%">Updated</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td data-title="JOB NUMBER">{{selectedBookingModel.id | PrettyID}}</td>

                    <td data-title="TIME"><span>{{selectedBookingModel.venue.start_time_iso | date:'shortTime'}} - {{selectedBookingModel.venue.end_time_iso | date:'shortTime'}}</span>
                    </td>
                    <td data-title="DATE"><span>{{selectedBookingModel.venue.start_time_iso | date:'EEE d MMM yy'}}
													</span></td>
                    <td data-title="ORGANISATION">AUSLAN</td>
                    <td data-title="Client">{{selectedBookingModel.client.organisation_primary_contact.first_name}}</td>
                    <td data-title="VENUE">{{selectedBookingModel.venue.title}}</td>
                    <td data-title="SUBURB">
                        <a target="_blank"
                           href="{{'https://www.google.com.au/maps/place/' +selectedBookingModel.venue.suburb}}">{{selectedBookingModel.venue.suburb}}</a>
                    </td>
                    <td data-title="TYPE OF JOB">{{selectedBookingModel.nature_of_appointment}}</td>
                    <td data-title="People">{{selectedBookingModel.venue.expected_attendance}}</td>
                    <td data-title="SPECIAL INSTRUCTIONS" class="new-line">{{selectedBookingModel.special_instructions}}</td>
                    <td align="center" data-title="Attached">
                                <ul *ngIf="selectedBookingModel.documents_attributes.length > 0" class="dropdown menu custom" data-dropdown-menu>
                                    <li>
                                        <a href="#" class="icon-attach"></a>
                                        <ul class="menu">
                                            <li *ngFor="let attachment of selectedBookingModel.documents_attributes"><a download href="{{attachment.url}}"><i class="icon-attach"></i> {{attachment.file_name}}</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </td>
                            <td data-title="Date Added">61 days (27 Jan)</td>
                            <td data-title="Updated"><span class="underline">02-06 TS<br>7:15 A</span></td>
                </tr>
                </tbody>
            </table>

            <section class="columns small-padding">
                <ng-container *ngIf="anyInterpreterAccepted()">
                    <ng-container *ngFor="let interpreter of selectedBookingModel.interpreters; let i=index">
                        <ng-container *ngIf="i < selectedBookingModel.interpreters_required">
                        <div *ngIf="interpreter.state === 'Accepted'"
                             class="row with-border">

                            <div> INTERPRETER {{i + 1}}
                            </div>
                            <span class="with-avatar">
                            <img src="{{interpreter.photo_url}}" alt="">
                    {{interpreter.first_name}} {{interpreter.last_name}}
                    </span>

                        </div>
                        <div *ngIf="interpreter.state !== 'Accepted'"
                             class="row with-border">
                            <div> INTERPRETER {{i + 1}}</div>
                            <span>To be filled</span>

                        </div>
                        </ng-container>
                    </ng-container>
                </ng-container>

                <div *ngIf="(selectedBookingModel.notes) && selectedBookingModel.notes.length > 0;"
                     class="row">
                    <span>DESCRIPTION</span>
                </div>
                <p>{{selectedBookingModel.notes}}</p>
                <div class="row">
                        <span>ATTACHMENTS</span>
                    </div>
                    <div>
                    <ul class="attachments" *ngIf="selectedBookingModel.documents_attributes.length > 0">
                        <li *ngFor="let attachment of selectedBookingModel.documents_attributes">
                                <a href="{{attachment.url}}">
                                    <i class="icon-attach"></i>
                                </a>
                                <span>{{attachment.file_name}}</span>
                            </li>
                            </ul>
                    </div>
                <div class="row">
                    <span>DO YOU WANT TO DO THIS JOB?</span>
                </div>
                <div class="manage-job-buttons">
                    <button class="button button-accept"
                            [ngClass]="isCurrentUserState('Accepted') ? 'button pushed button-accept' : 'button button-accept'"
                            (click)="!disableAccept && showDialogBox(false)"><i
                            class="icon-check-mobile"></i></button>

                    <button [disabled]="disableAccept" class="button button-help"><i class="icon-help"></i></button>

                    <button class="button button-decline"
                            [ngClass]="isCurrentUserState('Rejected') ? 'button pushed button-decline' : 'button button-decline'"
                            (click)="!disableReject && showDialogBox(true)"><i
                            class="icon-decline"></i></button>
                </div>
            </section>

            <ng-container *ngIf="anyInterpreterAccepted()">
                <div class="manage-interpreters-wrapper">
                    <section class="manage-interpreters">
                        <section>

                        <ng-container *ngFor="let interpreter of selectedBookingModel.interpreters; let i=index">
                            <div *ngIf="i < selectedBookingModel.interpreters_required">
                                    <b>Interpreter {{i + 1}} :</b>
                                    <span *ngIf="interpreter.state === 'Accepted'">{{interpreter.first_name}} {{interpreter.last_name}}</span>
                                    <span *ngIf="interpreter.state !== 'Accepted'">To be filled</span>
                                    <button *ngIf="!isCurrentUserInterpreter() && interpreter.state === 'Accepted'">
                                        Unassign
                                    </button>

                            </div>

                        </ng-container>
                        </section>
                    </section>
                </div>
            </ng-container>

            <h2 class="hidden-mobile">History</h2>
            <table id="changes-history" class="custom-small-table">
                <thead>
                <th width="20%" class="sort asc">Date and Time</th>
                <th width="30%" class="sort desc">Action</th>
                <th>Changes</th>
                </thead>
                <tbody>

                </tbody>
            </table>
        </main>
    </section>
</section>
